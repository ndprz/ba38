{% extends "base_bene.html" %}

{% block title %}ModÃ¨le Planning Palettes{% endblock %}

{% block content %}
<h2>ğŸ› ï¸ Mise Ã  jour du modÃ¨le de planning palettes</h2>

<form method="post">
<div class="table-responsive">
<table class="table table-bordered table-striped">
<thead>
<tr>
  <th>Jour</th>
  {% for i in range(1, 11) %}
    <th>Pal {{ i }}</th>
  {% endfor %}
  <th>DurÃ©e</th>  <!-- âœ… DurÃ©e ajoutÃ©e Ã  droite -->
</tr>
</thead>

<tbody>
{% for jour in jours %}
{% if jour != 'vendredi' or travail_vendredi != 'non' %}
<tr>
  <td class="text-capitalize">{{ jour }}</td>

  {% for i in range(1, 11) %}
  <td>
    <select class="form-select form-select-sm"
            name="pal{{ '%02d' % i }}_id_{{ jour }}"
            style="max-width:150px;">

      <option value="">-- Aucun --</option>

      {% set favoris = benevoles | selectattr('prep_palette', 'equalto', 'oui') | list %}
      {% set autres = benevoles | rejectattr('prep_palette', 'equalto', 'oui') | list %}

      {% for bene in favoris %}
      <option value="{{ bene.id }}"
        {% for ligne in model
             if ligne.jour == jour
             and ligne['pal%02d_id' % i] == bene.id %}
           selected
        {% endfor %}
        style="color:green;font-weight:bold;">
        âœ… {{ bene.nom_complet }}
      </option>
      {% endfor %}

      {% if favoris and autres %}
      <option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>
      {% endif %}

      {% for bene in autres %}
      <option value="{{ bene.id }}"
        {% for ligne in model
             if ligne.jour == jour
             and ligne['pal%02d_id' % i] == bene.id %}
           selected
        {% endfor %}>
        {{ bene.nom_complet }}
      </option>
      {% endfor %}
    </select>
  </td>
  {% endfor %}

  <!-- âœ… DurÃ©e Ã  droite -->
  <td>
    <input type="number"
           min="0"
           class="form-control form-control-sm"
           name="duree_{{ jour }}"
           value="{% for ligne in model if ligne.jour == jour %}{{ ligne.duree }}{% endfor %}"
           style="width: 90px;">
  </td>

</tr>
{% endif %}
{% endfor %}
</tbody>
</table>
</div>

<div class="mt-3 d-flex justify-content-between">
  <a class="btn btn-secondary" href="{{ url_for('planning.planning_main') }}">â†©ï¸ Retour</a>
  <button class="btn btn-primary" type="submit" name="action" value="enregistrer">ğŸ’¾ Enregistrer</button>
</div>

</form>
{% endblock %}

{% block styles %}
<style>
.table-responsive {
  overflow-x: auto;
  max-width: 100%;
}

th, td {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 150px;
  vertical-align: middle;
  text-align: center;
}

select.form-select {
  width: 100%;
  max-width: 150px;
  font-size: 0.85rem;
  padding: 0.2rem;
}
</style>
{% endblock %}
