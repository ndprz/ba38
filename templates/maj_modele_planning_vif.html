{% extends "base_bene.html" %}

{% block title %}ModÃ¨le Planning VIF{% endblock %}

{% block content %}
<h2>ModÃ¨le du planning VIF</h2>

<form method="POST">
  <table class="table table-bordered table-sm">
    <thead class="table-light">
      <tr>
        <th>Jour</th>
        <th>VIF matin</th>
        <th>VIF aprÃ¨s-midi</th>
        <th>DurÃ©e</th>  <!-- âœ… AJOUT ICI -->
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      {% for ligne in lignes %}
      <tr>
        <input type="hidden" name="ligne_ids[]" value="{{ ligne.id }}">

        <!-- JOUR -->
        <td>
          <select name="jour[]" class="form-select form-select-sm">
            {% for j in jours_semaine %}
              <option value="{{ j }}" {% if ligne.jour == j %}selected{% endif %}>{{ j|capitalize }}</option>
            {% endfor %}
          </select>
        </td>

        <!-- POSTES VIF -->
        {% for i in range(1, 3) %}
        <td>
          <select name="vif{{ "%02d"|format(i) }}[]" class="form-select form-select-sm">
            <option value="">-- Aucun --</option>

            {% set favoris = benevoles | selectattr('saisie_vif', 'equalto', 'oui') | list %}
            {% set autres = benevoles | rejectattr('saisie_vif', 'equalto', 'oui') | list %}

            {% for bene in favoris %}
              <option value="{{ bene.id }}"
                      {% if ligne['vif%02d_id' % i] == bene.id %}selected{% endif %}>
                âœ… {{ bene.nom }} {{ bene.prenom }}
              </option>
            {% endfor %}

            {% if favoris and autres %}<option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>{% endif %}

            {% for bene in autres %}
              <option value="{{ bene.id }}"
                      {% if ligne['vif%02d_id' % i] == bene.id %}selected{% endif %}>
                {{ bene.nom }} {{ bene.prenom }}
              </option>
            {% endfor %}
          </select>
        </td>
        {% endfor %}

        <!-- âœ… DURÃ‰E -->
        <td>
          <input type="number"
                 name="duree[]"
                 value="{{ ligne.duree or '' }}"
                 class="form-control form-control-sm"
                 min="0"
                 style="width:90px;">
        </td>

        <!-- ACTION SUPPR -->
        <td>
          <button type="submit"
                  name="action"
                  value="supprimer_{{ ligne.id }}"
                  class="btn btn-sm btn-danger">
            ğŸ—‘ï¸
          </button>
        </td>
      </tr>
      {% endfor %}

      {% if afficher_ligne_ajout %}
      <tr>
        <td>
          <select name="jour" class="form-select form-select-sm">
            {% for j in jours_semaine %}
              <option value="{{ j }}">{{ j|capitalize }}</option>
            {% endfor %}
          </select>
        </td>

        {% for i in range(1, 3) %}
        <td>
          <select name="vif{{ "%02d"|format(i) }}" class="form-select form-select-sm">
            <option value="">-- Aucun --</option>

            {% set favoris = benevoles | selectattr('saisie_vif', 'equalto', 'oui') | list %}
            {% set autres  = benevoles | rejectattr('saisie_vif', 'equalto','oui') | list %}

            {% for bene in favoris %}
              <option value="{{ bene.id }}">âœ… {{ bene.nom }} {{ bene.prenom }}</option>
            {% endfor %}

            {% if favoris and autres %}<option disabled>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</option>{% endif %}

            {% for bene in autres %}
              <option value="{{ bene.id }}">{{ bene.nom }} {{ bene.prenom }}</option>
            {% endfor %}
          </select>
        </td>
        {% endfor %}

        <!-- DurÃ©e nouvelle ligne -->
        <td>
          <input type="number" name="duree" class="form-control form-control-sm" min="0" style="width:90px;">
        </td>

        <td>
          <button type="submit" name="action" value="ajouter" class="btn btn-sm btn-success">â•</button>
        </td>
      </tr>
      {% endif %}
    </tbody>
  </table>

  <div class="mt-3 d-flex justify-content-between">
    <a class="btn btn-secondary" href="{{ url_for('planning.planning_main') }}">â†©ï¸ Retour</a>
    <button class="btn btn-primary" name="action" type="submit" value="enregistrer">ğŸ’¾ Enregistrer</button>
  </div>
</form>

<style>
  select option[disabled] { color: #ccc; }
</style>

{% endblock %}
