{% extends "base.html" %}
{% block title %}Gestion des pÃ´les{% endblock %}
{% block content %}

<h2>ðŸ‘¥ Gestion des pÃ´les dâ€™activitÃ©</h2>

<a href="{{ url_for('engagements.engagements_parametres_main') }}" class="btn btn-secondary mb-3">
    â¬… Retour
</a>

<table class="table table-bordered table-striped">
    <thead class="table-dark">
        <tr>
            <th>PÃ´le</th>
            <th>Responsable</th>
            <th>SupplÃ©ant 1</th>
            <th>SupplÃ©ant 2</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>

        {% for p in poles %}
        <form method="POST">
            <tr>
                <td>
                    <input type="hidden" name="pole_id" value="{{ p.id }}">
                    <input type="text" name="nom_affiche" class="form-control" value="{{ p.nom_affiche }}">
                </td>

                <td>
                    <select name="responsable_id" class="form-select select2">
                        <option value="">-- Aucun --</option>
                        {% for u in users %}
                        <option value="{{ u.id }}" {% if u.id==p.responsable_id %}selected{% endif %}>
                            {{ u.email }}
                        </option>
                        {% endfor %}
                    </select>
                </td>

                <td>
                    <select name="suppleant1_id" class="form-select select2">
                        <option value="">-- Aucun --</option>
                        {% for u in users %}
                        <option value="{{ u.id }}" {% if u.id==p.suppleant1_id %}selected{% endif %}>
                            {{ u.email }}
                        </option>
                        {% endfor %}
                    </select>
                </td>

                <td>
                    <select name="suppleant2_id" class="form-select select2">
                        <option value="">-- Aucun --</option>
                        {% for u in users %}
                        <option value="{{ u.id }}" {% if u.id==p.suppleant2_id %}selected{% endif %}>
                            {{ u.email }}
                        </option>
                        {% endfor %}
                    </select>
                </td>

                <td>
                    {% if has_access('engagement_parametres','ecriture') %}
                    <button type="submit" onclick="formChanged=false" class="btn btn-success btn-sm">
                        ðŸ’¾ Enregistrer
                    </button> {% endif %}
                </td>
            </tr>
        </form>
        {% endfor %}

    </tbody>
</table>

<script>
    let formChanged = false;

    document.querySelectorAll("input, select").forEach(el => {
        el.addEventListener("change", function () {
            formChanged = true;
        });
    });

    window.addEventListener("beforeunload", function (e) {
        if (formChanged) {
            e.preventDefault();
            e.returnValue = '';
        }
    });

</script>

{% endblock %}
